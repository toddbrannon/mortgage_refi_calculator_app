<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <title>Mortgage Data Input</title>

</head>
<body>
  <div class="container mt-3 text-center">
    <h1 class="mb-3">Mortgage Data Input</h1>
    <p class="mb-3">Date: <%= currentDate %></p>
    <form action="/update" method="POST" onsubmit="return validateForm()">
      <% data.forEach((row, index) => { %>
        <div class="row justify-content-center">
          <div class="col-md-5">
            <div class="card" style="background-color: #f8f9fa; border: 1px solid #000; border-radius: 8px;">
              <div class="card-body">

                <h4 class="mb-2">Basic Details</h4>
                <div class="form-group row mb-2">
                  <label class="col-md-4 col-form-label text-md-end">Borrower Name:</label>
                  <input type="text" name="borrowerName" class="form-control" value="<%= row.borrowerName %>" required />
                </div>
                <div class="form-group row mb-2">
                  <label class="col-md-4 col-form-label text-md-end">Current 1st Mortgage Balance:</label>
                  <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" step="0.01" name="current1stMortgageBal" class="form-control" value="<%= row.current1stMortgageBal.toFixed(2) %>" required min="0" style="background-color: #ffa07a;" />
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <label class="col-md-4 col-form-label text-md-end">Current 1st Mortgage Rate:</label>
                  <div class="input-group">
                    <input type="number" step="0.01" name="current1stMtgRate" class="form-control" value="<%= row.current1stMtgRate %>" required min="0" max="100" style="background-color: #ffa07a;" />
                    <span class="input-group-text">%</span>
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <label class="col-md-4 col-form-label text-md-end"><u><i>Current P I T I 1st Mtg.</i></u>:</label>
                  <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" step="0.01" class="form-control" value="<%= row.currentPITI1stMtg.toFixed(2) %>" readonly style="background-color: #ffffe0;" />
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <label class="col-md-4 col-form-label text-md-end">Current P & I or IO Pymt 1st Mtg.:</label>
                  <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" step="0.01" class="form-control" value="<%= row.currentPandIorIOPayment.toFixed(2) %>" readonly style="background-color: #ffffe0;" />
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <label class="col-md-4 col-form-label text-md-end">Current Monthly Mortgage Ins (MI):</label>
                  <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" step="0.01" class="form-control" value="<%= row.currentMonthlyMI ? row.currentMonthlyMI.toFixed(2) : '0.00' %>" readonly style="background-color: #ffffe0;" />
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <label class="col-md-4 col-form-label text-md-end">Current Annual Taxes:</label>
                  <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" step="0.01" class="form-control" value="<%= row.currentAnnualTaxes ? row.currentAnnualTaxes.toFixed(2) : '0.00' %>" readonly style="background-color: #d3d3d3;" />
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <label class="col-md-4 col-form-label text-md-end">Current Annual Insurance:</label>
                  <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" step="0.01" class="form-control" value="<%= row.currentAnnualInsurance ? row.currentAnnualInsurance.toFixed(2) : '0.00' %>" readonly style="background-color: #d3d3d3;" />
                  </div>
                </div>
                <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Current Ins Policy Eff. Date:</label>
                    <input type="text" name="currentInsPolicyEffDate" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Current 2nd Mtg Bal:</label>
                    <input type="number" step="0.01" name="current2ndMtgBal" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Current 2nd Mtg Rate:</label>
                    <input type="number" step="0.01" name="current2ndMtgRate" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Current P & I or IO Pymt 2nd:</label>
                    <input type="number" step="0.01" name="currentPandIorIOPymt2nd" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Total PITI 1st & 2nd:</label>
                    <input type="number" step="0.01" name="totalPITI1st2nd" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Total P&I & MI on 1st & 2nd & Other Debt:</label>
                    <input type="number" step="0.01" name="totalPandIMI1st2ndOtherDebt" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Bal of "Other" Debts to Payoff:</label>
                    <input type="number" step="0.01" name="balOfOtherDebtsToPayoff" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Mo. Pymt of "Other" Debt to payoff:</label>
                    <input type="number" step="0.01" name="moPymtOfOtherDebtToPayoff" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Last Payment Date:</label>
                    <input type="text" name="lastPaymentDate" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Est. Closing Date:</label>
                    <input type="text" name="estClosingDate" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Funding Date:</label>
                    <input type="text" name="fundingDate" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Month end:</label>
                    <input type="text" name="monthEnd" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">No Payment Due Month:</label>
                    <input type="text" name="noPaymentDueMonth" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">1st Payment due date:</label>
                    <input type="text" name="firstPaymentDueDate" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Est Escrow Refund (be conservative):</label>
                    <input type="number" step="0.01" name="estEscrowRefund" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Appraised Value:</label>
                    <input type="number" step="0.01" name="appraisedValue" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">FICO:</label>
                    <input type="number" name="fico" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Loan Purpose:</label>
                    <input type="text" name="loanPurpose" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Occupancy:</label>
                    <input type="text" name="occupancy" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">New Interest Rate:</label>
                    <input type="number" step="0.01" name="newInterestRate" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">PropertyType:</label>
                    <input type="text" name="propertyType" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">What type of loan is this?</label>
                    <input type="text" name="loanType" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Original MIP:</label>
                    <input type="number" step="0.01" name="originalMIP" class="form-control" />
                  </div>
                  <div class="form-group row mb-2">
                    <label class="col-md-4 col-form-label text-md-end">Refund of Original MIP:</label>
                    <input type="number" step="0.01" name="refundOfOriginalMIP" class="form-control" />
                  </div>
              </div>
            </div>
          </div>

          <!-- Right Side Card - Monthly Details -->
          <div class="col-md-5">
            <div class="card" style="background-color: #f8f9fa; border: 1px solid #000; border-radius: 8px;">
              <div class="card-body">
                <h4 class="mb-2">Monthly Details</h4>
                <div class="form-group row mb-2">
                  <label class="col-md-4 col-form-label text-md-end">Principle:</label>
                  <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" step="0.01" name="principle" class="form-control" value="<%= row.principle.toFixed(2) %>" required min="0" style="background-color: #ffa07a;" />
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <label class="col-md-4 col-form-label text-md-end">Interest:</label>
                  <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" step="0.01" name="interest" class="form-control" value="<%= row.interest.toFixed(2) %>" required min="0" style="background-color: #ffa07a;" />
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <label class="col-md-4 col-form-label text-md-end">Taxes:</label>
                  <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" step="0.01" class="form-control" value="<%= row.taxes.toFixed(2) %>" readonly style="background-color: #ffffe0;" />
                  </div>
                </div>
                <div class="form-group row mb-2">
                  <label class="col-md-4 col-form-label text-md-end">Insurance:</label>
                  <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" step="0.01" class="form-control" value="<%= row.insurance.toFixed(2) %>" readonly style="background-color: #ffffe0;" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% }) %>
      <button type="submit" class="btn btn-primary mt-2">Save Changes</button>
    </form>
  </div>
  <script>
    function validateForm() {
      const borrowerName = document.querySelector('input[name="borrowerName"]').value;
      const current1stMortgageBal = parseFloat(document.querySelector('input[name="current1stMortgageBal"]').value);
      const current1stMtgRate = parseFloat(document.querySelector('input[name="current1stMtgRate"]').value);
      const principle = parseFloat(document.querySelector('input[name="principle"]').value);
      const interest = parseFloat(document.querySelector('input[name="interest"]').value);

      if (borrowerName.trim() === "") {
        alert("Borrower Name is required.");
        return false;
      }

      if (isNaN(current1stMortgageBal) || current1stMortgageBal < 0) {
        alert("Please enter a valid Mortgage Balance greater than or equal to 0.");
        return false;
      }

      if (isNaN(current1stMtgRate) || current1stMtgRate < 0 || current1stMtgRate > 100) {
        alert("Please enter a valid Mortgage Rate between 0 and 100.");
        return false;
      }

      if (isNaN(principle) || principle < 0) {
        alert("Please enter a valid Principle amount greater than or equal to 0.");
        return false;
      }

      if (isNaN(interest) || interest < 0) {
        alert("Please enter a valid Interest amount greater than or equal to 0.");
        return false;
      }

      return true;
    }
  </script>
  <script src="/js/calculations.js"></script>
</body>
</html>